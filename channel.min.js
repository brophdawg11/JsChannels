(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Channel=b()}}}(this,function(){function a(p){var m=this,b=[],j=[],d=-1,k=null,i=false,f={},l;p=typeof p==="object"?p:{};for(l in f){if(typeof p[l]==="undefined"||p[l===null]){p[l]=f[l]}}function g(){if(!i&&b.length>0){d=-1;k=b.shift();o.apply(this)}}function o(){if(++d>=j.length||k===null){d=-1;k=null;g.apply(this);return}j[d].apply(this,k);if(!i){o.apply(this)}}this.read=function c(q){j.push(q);g.apply(this);return m};this.unread=function c(r){var s=-1,q=j.length;while(++s<q){if(j[s]===r){j.splice(s,1);break}}return m};this.block=function e(){if(!i){i=true;return true}return false};this.unblock=function h(){if(i){i=false;o.apply(this);return true}return false};this.write=function n(){if(j.length===0||b.length>0||i||d>=0){b.push(arguments)}else{k=arguments;o.apply(this)}return m}}a.alts=function(d){var e=Array.prototype.splice.call(arguments,1),f=-1,b=e.length,g;while(++f<b){g=e[f];g.read(d.bind(this,g))}};a.select=function(d){var e=Array.prototype.splice.call(arguments,1),g=-1,b=e.length,j,f=[];function h(i,k){return function c(n){var m=-1,l=e.length;while(++m<l){e[m].unread(f[m])}return k.apply(n,arguments)}.bind(null,i)}while(++g<b){j=e[g];f.push(h(j,d));j.read(f[g])}};return a}));